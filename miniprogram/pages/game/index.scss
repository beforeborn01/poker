@use "sass:math";

$blue: #002FA7;
$border: #e5e7eb;
$text: #1a1a1a;

.page {
  margin: 0 auto;
  min-height: 100vh;
  background: #ffffff;
  padding: calc(10px * var(--scale, 1)) calc(10px * var(--scale, 1)) calc(88px * var(--scale, 1));
}

.header {
  position: relative;
  padding: calc(env(safe-area-inset-top) + 12px) 0 calc(8px * var(--scale, 1));
  text-align: center;
  .title { font-weight: 700; font-size: calc(18px * var(--scale, 1)); color: $text; }
}

.arena {
  position: relative;
  height: calc(100vh - 180px);
}

.flying-card {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 72px;
  height: 96px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  pointer-events: none;
  background: #fff;
  border: 1px solid #e5e7eb;
  
  &.flying {
    animation: flyCard 1s ease-out forwards;
  }
  
  /* 为多张飞牌添加错开时间 */
  &:nth-child(1) { animation-delay: 0ms; }
  &:nth-child(2) { animation-delay: 150ms; }
  &:nth-child(3) { animation-delay: 300ms; }
  &:nth-child(4) { animation-delay: 450ms; }
  &:nth-child(5) { animation-delay: 600ms; }
  &:nth-child(6) { animation-delay: 750ms; }
  &:nth-child(7) { animation-delay: 900ms; }
  &:nth-child(8) { animation-delay: 1050ms; }
  &:nth-child(9) { animation-delay: 1200ms; }
  &:nth-child(10) { animation-delay: 1350ms; }
  &:nth-child(11) { animation-delay: 1500ms; }
  &:nth-child(12) { animation-delay: 1650ms; }
}

.dealer {
  position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
  display: flex; flex-direction: column; align-items: center; gap: 12px;
  .card-back { 
    width: 96px; height: 128px; border-radius: 12px; 
    box-shadow: 0 8px 24px rgba(0, 47, 167, 0.25), 0 4px 12px rgba(0,0,0,.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    background: transparent;
    overflow: hidden;
    &:active { transform: scale(0.98); }
  }
  
  .dealing-animation {
    animation: dealCard 1s ease-out forwards;
  }
  
  .remain { 
    color: $text; font-size: 14px; font-weight: 500;
    background: rgba(255, 255, 255, 0.9);
    padding: 4px 12px;
    border-radius: 12px;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(0, 47, 167, 0.1);
  }
  .deal { 
    background: linear-gradient(135deg, $blue 0%, #0038CC 100%);
    color: #fff; height: 36px; border-radius: 999px; padding: 0 16px; 
    font-weight: 700; display: inline-flex; align-items: center; justify-content: center; 
    width: auto; min-width: unset;
    box-shadow: 0 4px 12px rgba(0, 47, 167, 0.3);
    transition: all 0.2s ease;
    &:active { 
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(0, 47, 167, 0.4);
    }
    &:disabled {
      background: #9ca3af;
      box-shadow: 0 2px 6px rgba(156, 163, 175, 0.3);
      cursor: not-allowed;
      &:active {
        transform: none;
      }
    }
  }
}

.player {
  position: absolute;
  width: 110px;
  .name { 
    text-align: center; color: $text; font-weight: 500; margin-bottom: 6px;
    background: rgba(255, 255, 255, 0.9);
    padding: 2px 8px;
    border-radius: 8px;
    backdrop-filter: blur(4px);
    border: 1px solid rgba(0, 47, 167, 0.1);
    font-size: 13px;
  }
  .pile { position: relative; height: 100px; }
  .pile.small { height: 90px; }
  .card.face {
    position: absolute; left: 50%; top: 0; transform: translateX(-50%);
    width: 72px; height: 96px; border: 1px solid $border; background: #fff; border-radius: 10px;
    box-shadow: 0 6px 16px rgba(0,0,0,.12), 0 2px 6px rgba(0,0,0,.08);
    display: flex; align-items: flex-start; padding: 0 6px 6px 6px; overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    &:hover { transform: translateX(-50%) translateY(-2px); }
  }
  .card.top { z-index: 999; }
  .corner { display: flex; align-items: center; gap: 4px; margin-top: 0; position: absolute; left: 6px; top: 0; }
  .corner.br { right: 6px; bottom: 0; left: auto; top: auto; justify-content: flex-end; }
  .suit { font-size: 14px; }
  .rank { font-size: 16px; font-weight: 700; }
  .suit.red, .rank.red { color: #e02424; }
}

.card.face .corner { position: absolute; left: 6px; top: 0; display: flex; align-items: center; gap: 4px; }
.card.face .corner.br { right: 6px; bottom: 0; left: auto; top: auto; justify-content: flex-end; }

/* 全局红色角标，适用于弹层与玩家区域 */
.suit.red, .rank.red { color: #e02424; }
.rank.joker { font-size: 12px; }

.modal-mask { position: fixed; left:0; top:0; right:0; bottom:0; background: rgba(0,0,0,.45); display:flex; align-items:center; justify-content:center; z-index: 999; }
.modal.large { width: 86%; background: #fff; border-radius: 12px; padding: 16px; }
.modal-title { font-weight: 700; margin-bottom: 10px; }
.pile-view { position: relative; height: 60vh; overflow-y: auto; margin-top: 8px; }
.modal .card.face { position: absolute; left: 50%; transform: translateX(-50%); width: 90px; height: 120px; border: 1px solid $border; background: #fff; border-radius: 8px; box-shadow: 0 6px 14px rgba(0,0,0,.12); padding: 0 6px 6px 6px; }
.modal-actions { display:flex; justify-content:center; margin-top: 12px; }
.btn.primary { background: $blue; color:#fff; border-radius: 999px; padding: 8px 16px; }

.player.top { display: flex; flex-direction: column; align-items: center; }
.player.bottom { display: flex; flex-direction: column; align-items: center; }
.player.bottom .name { margin-bottom: 4px; }
.player.middle { display: flex; flex-direction: column; align-items: center; }

.footer-row {
  position: sticky; bottom: 0; padding: 12px 0 16px; padding-bottom: calc(env(safe-area-inset-bottom) + 16px);
  display: flex; justify-content: center; gap: 16px;
  .primary, .secondary { 
    height: 44px; border-radius: 999px; padding: 0 20px; width: auto; min-width: unset;
    display: inline-flex; align-items: center; justify-content: center; line-height: 1;
    font-weight: 700; transition: all 0.2s ease;
  }
  .primary { 
    background: linear-gradient(135deg, $blue 0%, #0038CC 100%);
    color: #fff; 
    box-shadow: 0 4px 12px rgba(0, 47, 167, 0.3);
    &:active { 
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(0, 47, 167, 0.4);
    }
  }
  .secondary { 
    border: 1px solid $border; background: #f8fafc; color: $text;
    &:active { 
      background: #f1f5f9;
      transform: translateY(1px);
    }
  }
}




/* 发牌区动画 */
@keyframes dealCard {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(0.95);
  }
  100% {
    transform: scale(1);
  }
}

/* 飞牌动画 */
@keyframes flyCard {
  0% {
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(1) rotate(0deg);
    opacity: 1;
  }
  100% {
    left: var(--target-x, 50%);
    top: var(--target-y, 50%);
    transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
    opacity: 0;
  }
}
